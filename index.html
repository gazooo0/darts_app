<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>回転ターゲットダーツアプリ</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: sans-serif;
      margin: 20px;
    }
    #controls {
      margin-bottom: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: flex-start;
    }
    .control-group {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }
    canvas {
      border: 2px solid #333;
      border-radius: 8px;
      background: #fff;
      cursor: pointer;
    }
    #result {
      font-size: 20px;
      margin-top: 12px;
      min-height: 24px;
    }
    .label-input, .color-input {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 12px;
    }
    .label-input input, .color-input input {
      width: 60px;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div id="controls">
    <div class="control-group">
      <label>半径 (inner,outer): <input id="radii-input" type="text" value="100,180" size="10"></label>
      <button id="update-btn">更新</button>
      <button id="start-btn">Start</button>
      <div>※Startを押して高速回転、円をクリックすると停止</div>
    </div>
    <div class="control-group" id="labels-group">
      <!-- ラベル入力 10個 -->
      <div class="label-input"><label>項目1<input id="segment-1" type="text" value="A"></label></div>
      <div class="label-input"><label>項目2<input id="segment-2" type="text" value="B"></label></div>
      <div class="label-input"><label>項目3<input id="segment-3" type="text" value="C"></label></div>
      <div class="label-input"><label>項目4<input id="segment-4" type="text" value="D"></label></div>
      <div class="label-input"><label>項目5<input id="segment-5" type="text" value="E"></label></div>
      <div class="label-input"><label>項目6<input id="segment-6" type="text" value="F"></label></div>
      <div class="label-input"><label>項目7<input id="segment-7" type="text" value="G"></label></div>
      <div class="label-input"><label>項目8<input id="segment-8" type="text" value="H"></label></div>
      <div class="label-input"><label>項目9<input id="segment-9" type="text" value="I"></label></div>
      <div class="label-input"><label>項目10<input id="segment-10" type="text" value="J"></label></div>
    </div>
    <div class="control-group" id="colors-group">
      <!-- 色入力 10個 -->
      <div class="color-input"><label>色1<input id="color-1" type="color" value="#ff8888"></label></div>
      <div class="color-input"><label>色2<input id="color-2" type="color" value="#88ff88"></label></div>
      <div class="color-input"><label>色3<input id="color-3" type="color" value="#8888ff"></label></div>
      <div class="color-input"><label>色4<input id="color-4" type="color" value="#ff88ff"></label></div>
      <div class="color-input"><label>色5<input id="color-5" type="color" value="#88ffff"></label></div>
      <div class="color-input"><label>色6<input id="color-6" type="color" value="#ffff88"></label></div>
      <div class="color-input"><label>色7<input id="color-7" type="color" value="#ffcc88"></label></div>
      <div class="color-input"><label>色8<input id="color-8" type="color" value="#cc88ff"></label></div>
      <div class="color-input"><label>色9<input id="color-9" type="color" value="#88ccff"></label></div>
      <div class="color-input"><label>色10<input id="color-10" type="color" value="#ccbbee"></label></div>
    </div>
  </div>
  <canvas id="dartboard" width="400" height="400"></canvas>
  <div id="result"></div>

  <script>
    const canvas = document.getElementById('dartboard');
    const ctx = canvas.getContext('2d');
    const center = { x: canvas.width / 2, y: canvas.height / 2 };
    let segments = [];
    let radii = {};
    let colors = [];
    let rotation = 0;
    let animId;
    let spinning = false;
    let marker = null; // クリック位置マーカー

    function parseInputs() {
      const [inner, outer] = document.getElementById('radii-input')
        .value.split(',').map(n => parseInt(n, 10));
      radii = { inner, outer };
      segments = [];
      for (let i = 1; i <= 10; i++) {
        const val = document.getElementById(`segment-${i}`).value.trim();
        segments.push(val || '-');
      }
      colors = [];
      for (let i = 1; i <= 10; i++) {
        colors.push(document.getElementById(`color-${i}`).value);
      }
      marker = null;
    }

    function drawBoard() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.save();
      ctx.translate(center.x, center.y);
      ctx.rotate(rotation);
      const count = segments.length;
      const angle = (2 * Math.PI) / count;

      for (let i = 0; i < count; i++) {
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.fillStyle = colors[i];
        ctx.arc(0, 0, radii.outer, i * angle, (i + 1) * angle);
        ctx.closePath();
        ctx.fill();
      }
      // ラベル
      ctx.fillStyle = '#000';
      ctx.font = '14px sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      for (let i = 0; i < count; i++) {
        const a = (i + 0.5) * angle;
        const r = radii.outer * 0.6;
        ctx.fillText(segments[i], Math.cos(a) * r, Math.sin(a) * r);
      }
      ctx.restore();

      // マーカー描画
      if (marker) {
        ctx.beginPath();
        ctx.fillStyle = '#000';
        ctx.arc(marker.x, marker.y, 3, 0, 2 * Math.PI);
        ctx.fill();
      }
    }

    function animate() {
      if (spinning) {
        rotation += 0.3; // 高速回転
      }
      drawBoard();
      animId = requestAnimationFrame(animate);
    }

    canvas.addEventListener('click', e => {
      if (!spinning) return;
      spinning = false;
      document.getElementById('start-btn').disabled = false;
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      marker = { x, y };
      // 判定はラベルのみ表示
      const mx = x - center.x;
      const my = y - center.y;
      const d = Math.hypot(mx, my);
      let label = '-';
      if (d <= radii.outer) {
        const angle = (2 * Math.PI) / segments.length;
        const a = ((Math.atan2(my, mx) - rotation) % (2 * Math.PI) + 2 * Math.PI) % (2 * Math.PI);
        const idx = Math.floor(a / angle);
        label = segments[idx];
      }
      document.getElementById('result').textContent = label;
    });

    document.getElementById('update-btn').addEventListener('click', () => {
      if (spinning) return;
      parseInputs();
      drawBoard();
      document.getElementById('result').textContent = '';
    });

    document.getElementById('start-btn').addEventListener('click', () => {
      parseInputs();
      spinning = true;
      document.getElementById('start-btn').disabled = true;
      animate();
    });

    // 初期描画
    parseInputs();
    drawBoard();
    animate();
  </script>
</body>
</html>
