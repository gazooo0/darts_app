<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>回転ターゲットダーツアプリ</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: sans-serif;
      margin: 20px;
    }
    #controls {
      margin-bottom: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: flex-start;
    }
    .control-group {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }
    canvas {
      border: 2px solid #333;
      border-radius: 8px;
      background: #fff;
      cursor: pointer;
    }
    #result {
      font-size: 20px;
      margin-top: 12px;
      min-height: 24px;
    }
    .label-input, .color-input {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 12px;
    }
    .label-input input, .color-input input {
      width: 60px;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div id="controls">
    <div class="control-group">
      <label>半径 (inner,outer): <input id="radii-input" type="text" value="100,180" size="10"></label>
      <button id="update-btn">更新</button>
      <button id="start-btn">Start</button>
      <div>※Startを押して高速回転、円をクリックすると停止</div>
    </div>
    <div class="control-group" id="labels-group">
      <!-- ラベル入力 10個 -->
      ${Array.from({ length: 10 }).map((_, i) =>
        `<div class="label-input"><label>項目${i+1}<input id="segment-${i+1}" type="text" value="${String.fromCharCode(65+i)}"></label></div>`
      ).join('')}
    </div>
    <div class="control-group" id="colors-group">
      <!-- 色入力 10個 -->
      ${['#ff8888','#88ff88','#8888ff','#ff88ff','#88ffff','#ffff88','#ffcc88','#cc88ff','#88ccff','#ccbbee'].map((c, i) =>
        `<div class="color-input"><label>色${i+1}<input id="color-${i+1}" type="color" value="${c}"></label></div>`
      ).join('')}
    </div>
  </div>
  <canvas id="dartboard" width="400" height="400"></canvas>
  <div id="result"></div>

  <script>
    const canvas = document.getElementById('dartboard');
    const ctx = canvas.getContext('2d');
    const center = { x: canvas.width / 2, y: canvas.height / 2 };
    let segments = [];
    let radii = {};
    let colors = [];
    let rotation = 0;
    let animId;
    let spinning = false;

    function parseInputs() {
      const [inner, outer] = document.getElementById('radii-input').value.split(',').map(n => parseInt(n));
      radii = { inner, outer };
      segments = [];
      for (let i = 1; i <= 10; i++) {
        segments.push(document.getElementById(`segment-${i}`).value.trim() || '-');
      }
      colors = [];
      for (let i = 1; i <= 10; i++) {
        colors.push(document.getElementById(`color-${i}`).value);
      }
    }

    function drawBoard() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.save();
      ctx.translate(center.x, center.y);
      ctx.rotate(rotation);

      const count = segments.length;
      const angle = 2 * Math.PI / count;

      for (let i = 0; i < count; i++) {
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.fillStyle = colors[i];
        ctx.arc(0, 0, radii.outer, i * angle, (i + 1) * angle);
        ctx.closePath();
        ctx.fill();
      }

      ctx.fillStyle = '#000';
      ctx.font = '14px sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      for (let i = 0; i < count; i++) {
        const a = (i + 0.5) * angle;
        const r = radii.outer * 0.6;
        ctx.fillText(segments[i], Math.cos(a) * r, Math.sin(a) * r);
      }

      ctx.restore();
    }

    function animate() {
      rotation += spinning ? 0.3 : 0; // スピン時は速め
      drawBoard();
      animId = requestAnimationFrame(animate);
    }

    canvas.addEventListener('click', () => {
      if (!spinning) return;
      spinning = false;
      document.getElementById('start-btn').disabled = false;
      cancelAnimationFrame(animId);
      // 結果判定
      const x = event.clientX - canvas.getBoundingClientRect().left - center.x;
      const y = event.clientY - canvas.getBoundingClientRect().top - center.y;
      const d = Math.hypot(x, y);
      let result;
      if (d <= radii.inner) result = '当たり';
      else if (d <= radii.outer) result = '端っこヒット';
      else result = 'はずれ';
      let label = '-';
      if (d <= radii.outer) {
        const a = (Math.atan2(y, x) - rotation + 2 * Math.PI) % (2 * Math.PI);
        label = segments[Math.floor(a / (2 * Math.PI / segments.length))];
      }
      document.getElementById('result').textContent = `${label} → ${result}`;
    });

    document.getElementById('update-btn').addEventListener('click', () => {
      if (spinning) return;
      parseInputs();
      drawBoard();
      document.getElementById('result').textContent = '';
    });

    document.getElementById('start-btn').addEventListener('click', () => {
      parseInputs();
      spinning = true;
      document.getElementById('start-btn').disabled = true;
      animate();
    });

    // 初期表示
    parseInputs();
    drawBoard();
  </script>
</body>
</html>
